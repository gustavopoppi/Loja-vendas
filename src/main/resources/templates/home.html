<html>
<head th:replace="~{base :: head}"></head>
<body id="body">
	<div th:replace="~{base :: logo}"></div>

	<div class="container" id="homeDto" v-on:change="getMes()">

		<nav
			class="navbar navbar-expand navbar-light d-flex justify-content-between mb-3">
			<a href="/venda/formulario"><button
					class="btn btn-outline-secondary my-sm-0">Nova Venda</button></a>
			<div>
				<input class="my-sm-0" placeholder="Buscar"></input>
				<button class="btn btn-outline-secondary">Buscar</button>
			</div>
		</nav>

		<div id="base"
			th:replace="~{base :: titulo('Minhas Vendas', ${localDate})}"></div>

		<!--
		TESTES-->
		<!--<div class="card mb-3" v-for="(teste,index) in vendasDto.listaVendas">
				<p>  {{ teste[0].id }} - {{index}} - {{vendasDto.usuariosVendaEmAberto.length}} - {{vendasDto.vendas.length}}-->
				<!--<span>{{vendasDto.listaParcelas.length}}  </span> -->
		<!--</div>-->

		<div id="parcela" v-bind:class="[classObject(vendasDto.listaParcelas), row]"> 
			<span>{{vendasDto.listaParcelas[0][0].valorPago}}</span>
		</div>
		
		<!--  <div th:switch="APROVADO">
		  <div th:case="'APROVADO'" class="card-header alert-success"><p>teste</p></div>
		  <div th:case="'AGUARDANDO'" class="card-header alert-warning"></div>
		  <p>teste</p>
		</div>-->

		<div class="row" v-for="(parcela,index) in vendasDto.listaParcelas" :key="parcela.id">

			<div class="card-body border mt-2">
				<div class="row">
					<div class="col-12 mb-3">
						<div class="row">
							<div id="vendaNomeCliente" class="col-md-5">
								<span>{{parcela[0].venda.cliente.nomeCliente}}</span>
							</div>

							<div id="vendaQtdeCompras" class="col-md-5">
								<span v-if="index < vendasDto.usuariosVendaEmAberto.length">Total de
									Compras: {{parcela.length}}</span>
							</div>

							<div id="vendaValorTotalCliente" class="col-md-2">
								<!--  <span th:text="${'Total: R$ ' + valoresTotais[{vendaStat.index}]}"></span> -->
								<span>Total: R$
									{{vendasDto.valoresTotaisClientesEmAberto[index]}}</span>
							</div>

						</div>
						<div class="card-body">
							<div class="row">
								<div class="col-md-1">Cód:</div>
								<div class="col-md-3">Descrição:</div>
								<div class="col-md-1">pc:</div>
								<div class="col-md-3">Valor pc:</div>
								<div class="col-md-2">Total Venda:</div>
								<div class="col-md-2">Data à Pagar:</div>
							</div>

							<div v-bind:class="[classObject(parcelaDois.status), row]" v-for="(parcelaDois,indexDois) in parcela">
								
								<!--  <div th:switch="'APROVADO'">
									<div th:case="'APROVADO'" class="card-header alert-success"></div>
									<div th:case="'AGUARDANDO'" class="card-header alert-warning"></div>
								</div>-->								
									<div id="vendaId" class="col-md-1">
										<span>{{parcelaDois.venda.id}}</span>
									</div>
	
									<div id="vendaNomeProduto" class="col-md-3">
										<span>{{parcelaDois.venda.nomeProduto}}</span>
									</div>
	
									<div id="vendaQtdeParcelas" class="col-md-1">
										<span>{{parcelaDois.parcela}}/{{parcelaDois.venda.qtdeParcelas}}</span>
									</div>
	
									<div id="vendaValorParcela" class="col-md-3">
										<span>R$ {{parcelaDois.valorParcela}}</span>
									</div>
	
									<div id="vendaValorTotal" class="col-md-2">
										<span>{{parcelaDois.venda.valorTotal}}</span>
									</div>
	
									<div id="vendaDataCompra" class="col-md-2">
										<span>{{parcelaDois.dataParcela}}</span>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

		</div>
		<div class="d-flex justify-content-end">
			<!--  <span id="valorTotalVendas" th:text="${'Valor Total: R$ ' + valorTotalVendas}"></span>-->
			<span>Valor TOTAL R$: {{vendasDto.valorTotalVendas}}</span>
		</div>
	</div>



	<div id="app-3">
		<p v-if="seen">Agora você me viu</p>
	</div>

</body>


<script>
window.addEventListener("load", onLoad);

	function teste(){
		console.log("entrou na teste")
		onLoad()
	}
	
	function onLoad(){
		console.log("entrou na load")
		var mesAtual = new Date().getMonth() + 1;
		console.log("int do mes selecionado " + mesAtual)
		var app = new Vue({
			el : '#homeDto',
			data : {
				vendasDto : [],
				count: 0,
				row: 'row'
			},
			mounted(){
				axios
					.get('/api/home'+ '?mes=' + mesAtual)
					.then(response => {
						this.vendasDto = response.data;
						console.log(this.vendasDto);
					})
				//getClass(this.vendasDto)
			},/*,
			computed: {			  
			  classObject: function (teste) {
				  var expr = 'AGUARDANDO'
				  console.log(teste)
				  switch (expr) {
			      case 'AGUARDANDO':
			    	console.log("entrou no = 0")
			    	return 'alert-danger'
			        break;
			      case 'PARCIAL':
			    	console.log("entrou no >= 1")
			    	return 'alert-warning'
			    	break;
			      case 'PAGA':
			    	console.log("entrou no >= 1")
			    	return 'alert-success'
			    	break;
			      default:
			        console.log(`Sorry, we are out of ${expr}.`);
				  
			    return {
			      'text-danger': this.teste && this.vendasDto != null
			      
			      
			    }
			      
			    }
			  }
			},*/
			methods: {
				getMes : function(){
					var novoValorMes = document.querySelector("#listaMeses").value
					console.log(novoValorMes)
					axios
					  .get('/api/home' + '?mes=' + novoValorMes)
					  .then(response => {
					  	this.vendasDto = response.data;
						console.log(this.vendasDto);
						console.log("entrou no teste")
					})
				 },	
				 
				 classObject: function (teste) {
					  var expr = teste
					  console.log("acima do teste")
					  console.log(teste)
					  switch (expr) {
				      case 'AGUARDANDO':
				    	console.log("entrou no = 0")
				    	return 'alert-danger'
				        break;
				      case 'PARCIAL':
				    	console.log("entrou no >= 1")
				    	return 'alert-warning'
				    	break;
				      case 'PAGA':
				    	console.log("entrou no >= 1")
				    	return 'alert-success'
				    	break;
				      default:
				        console.log(`Sorry, we are out of ${expr}.`);
					  
				    return {
				      'text-danger': this.teste && this.vendasDto != null
				    }
					  }
				 }
				 /*getClass2 : function(listaParcelas) {
						console.log("get class")
						console.log(listaParcelas)
						var idParcela = document.getElementById("parcela");
						idParcela.classList.add("alert-success");
			
				}*/
			
			}
		})
		document.getElementById("listaMeses").value = mesAtual
	}
		
	/*function getClass(listaParcelas){
		console.log("get class")
		console.log(listaParcelas)
		var idParcela = document.getElementById("parcela");
		idParcela.classList.add("alert.success")
	}*/
	
	function mostrarResposta(venda) {
	    const mensagem = `
	        venda: ${venda.listaParcelas[0][0].venda.cliente.nomeCliente},
	        parcela: ${venda.parcelas[0].ativa},
	        dataParcela: ${venda.parcelas[0].dataParcela}
	    `;
	    alert(mensagem);
	}
</script>






</html>